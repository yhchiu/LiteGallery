> zoom åŠŸèƒ½å€¼å¾—å¾ç¨ç«‹å¯¦ä½œæ”¹ç”¨ Media3 çš„ ScaleEffect or custom VideoEffect å—ï¼Ÿ

â— è®“æˆ‘åˆ†æä¸€ä¸‹æ˜¯å¦å€¼å¾—å¾ç›®å‰çš„è‡ªå®šç¾©ç¸®æ”¾å¯¦ä½œæ”¹ç”¨ Media3 çš„ VideoEffect ç³»çµ±ã€‚

â— è®“æˆ‘è©³ç´°åˆ†æç›®å‰çš„è‡ªå®šç¾©ç¸®æ”¾å¯¦ä½œå’Œ Media3 VideoEffect çš„æ¯”è¼ƒï¼š

  ç›®å‰è‡ªå®šç¾©å¯¦ä½œ vs Media3 VideoEffect æ¯”è¼ƒåˆ†æ

  ç›®å‰è‡ªå®šç¾©å¯¦ä½œçš„ç‰¹é»

  åŸºæ–¼æˆ‘æª¢æŸ¥çš„ ZoomablePlayerView.kt ç¨‹å¼ç¢¼ï¼š

  å„ªå‹¢:
  1. å®Œå…¨æ§åˆ¶: ç›´æ¥æ“ä½œ TextureView/SurfaceView çš„ Matrix è®Šæ›
  2. å³æ™‚éŸ¿æ‡‰: æ‰‹å‹¢è­˜åˆ¥å¾Œç«‹å³æ‡‰ç”¨è®Šæ›ï¼Œå»¶é²æ¥µä½
  3. éˆæ´»æ€§: å¯ä»¥ç²¾ç¢ºæ§åˆ¶ç¸®æ”¾ä¸­å¿ƒé»ã€ç´„æŸé‚è¼¯
  4. UIæ•´åˆ: èˆ‡ ViewPager2 çš„æ»‘å‹•è¡çªè™•ç†å·²ç¶“å®Œå–„
  5. è¨˜æ†¶é«”æ•ˆç‡: ä¸éœ€è¦é¡å¤–çš„ GPU è³‡æºé€²è¡Œå½±ç‰‡è™•ç†

  ç¼ºé»:
  1. è¡¨é¢è®Šæ›: åªæ˜¯è¦–è¦ºä¸Šçš„ç¸®æ”¾ï¼Œä¸æ˜¯çœŸæ­£çš„å½±ç‰‡å…§å®¹ç¸®æ”¾
  2. å“è³ªé™åˆ¶: æ”¾å¤§æ™‚å¯èƒ½å‡ºç¾åƒç´ åŒ–
  3. å…¼å®¹æ€§: éœ€è¦è™•ç† TextureView å’Œ SurfaceView çš„å·®ç•°

  Media3 VideoEffect çš„ç‰¹é»

  Media3 VideoEffect çš„å„ªå‹¢:
  1. çœŸæ­£çš„å½±ç‰‡è™•ç†: åœ¨ GPU å±¤é¢è™•ç†å½±ç‰‡å¹€
  2. æ›´å¥½çš„å“è³ª: å¯ä»¥ä½¿ç”¨é«˜å“è³ªçš„ç¸®æ”¾ç®—æ³•
  3. çµ±ä¸€è™•ç†: ä¸éœ€è¦å€åˆ† TextureView/SurfaceView
  4. æ“´å±•æ€§: å¯ä»¥çµåˆå…¶ä»–å½±ç‰‡æ•ˆæœï¼ˆæ¿¾é¡ã€è‰²å½©èª¿æ•´ç­‰ï¼‰

  Media3 VideoEffect çš„ç¼ºé»:
  1. æ€§èƒ½é–‹éŠ·: GPU è™•ç†æ¯ä¸€å¹€éƒ½éœ€è¦é¡å¤–è¨ˆç®—
  2. å»¶é²: æ•ˆæœç®¡ç·šå¯èƒ½å¼•å…¥å»¶é²
  3. è¤‡é›œæ€§: éœ€è¦å¯¦ä½œ GLSL shader æˆ–ä½¿ç”¨é è¨­æ•ˆæœ
  4. è¨˜æ†¶é«”: é¡å¤–çš„ GPU è¨˜æ†¶é«”ä½¿ç”¨
  5. é›»æ± æ¶ˆè€—: GPU è™•ç†æœƒå¢åŠ è€—é›»

  å…·é«”å¯¦ä½œæ¯”è¼ƒ

  ç›®å‰çš„ Matrix è®Šæ›æ–¹å¼

  // å³æ™‚è®Šæ›ï¼Œç„¡é¡å¤–é–‹éŠ·
  surface.setTransform(transformMatrix)
  surface.invalidate()

  Media3 VideoEffect æ–¹å¼ï¼ˆå‡è¨­å¯¦ä½œï¼‰

  // éœ€è¦ GPU è™•ç†æ¯ä¸€å¹€
  val scaleEffect = ScaleEffect.Builder()
      .setScaleX(scaleX)
      .setScaleY(scaleY)
      .build()

  player.setVideoEffects(listOf(scaleEffect))

  é‡å° LiteGallery çš„å…·é«”åˆ†æ

  åŸºæ–¼é€™æ˜¯ä¸€å€‹åœ–ç‰‡/å½±ç‰‡ç€è¦½å™¨çš„ä½¿ç”¨å ´æ™¯ï¼š

  æ¨è–¦: ä¿æŒç¾æœ‰è‡ªå®šç¾©å¯¦ä½œ

  ç†ç”±:

  1. ä½¿ç”¨å ´æ™¯åŒ¹é…
    - ç”¨æˆ¶ä¸»è¦éœ€è¦å¿«é€Ÿç€è¦½å’Œæª¢è¦–ç´°ç¯€
    - ä¸éœ€è¦è¤‡é›œçš„å½±ç‰‡è™•ç†æ•ˆæœ
    - ç¸®æ”¾ä¸»è¦ç”¨æ–¼æŸ¥çœ‹å½±ç‰‡ç´°ç¯€ï¼Œè€Œéå‰µä½œ
  2. æ€§èƒ½å„ªå‹¢
    - ç›®å‰å¯¦ä½œå»¶é²æ¥µä½ï¼Œæ‰‹å‹¢éŸ¿æ‡‰å³æ™‚
    - ä¸æ¶ˆè€—é¡å¤– GPU è³‡æº
    - ç‰¹åˆ¥é©åˆå¤§å°ºå¯¸å½±ç‰‡æª”æ¡ˆçš„ç€è¦½
  3. ç¾æœ‰åŠŸèƒ½å®Œå–„
    - å·²ç¶“è™•ç†äº† ViewPager2 æ»‘å‹•è¡çª
    - æ”¯æ´å¤šé»è§¸æ§å’Œæ‰‹å‹¢è­˜åˆ¥
    - ç¸®æ”¾ç´„æŸé‚è¼¯å®Œæ•´
  4. è¨˜æ†¶é«”å‹å–„
    - ç¨‹å¼ç¢¼é¡¯ç¤ºå·²ç¶“æœ‰å®Œå–„çš„è¨˜æ†¶é«”ç®¡ç†
    - ä¸éœ€è¦é¡å¤–çš„ GPU è¨˜æ†¶é«”åˆ†é…

  ä»€éº¼æƒ…æ³ä¸‹è€ƒæ…® VideoEffectï¼Ÿ

  åªæœ‰åœ¨ä»¥ä¸‹æƒ…æ³æ‰å»ºè­°æ”¹ç”¨ Media3 VideoEffectï¼š

  1. éœ€è¦å½±ç‰‡ç·¨è¼¯åŠŸèƒ½: å¦‚æœæœªä¾†è¦åŠ å…¥æ¿¾é¡ã€è‰²å½©èª¿æ•´ç­‰
  2. éœ€è¦é«˜å“è³ªç¸®æ”¾: å¦‚æœç”¨æˆ¶ç¶“å¸¸éœ€è¦å¤§å¹…åº¦ç¸®æ”¾æŸ¥çœ‹ç´°ç¯€
  3. æ•´åˆå…¶ä»–æ•ˆæœ: å¦‚æœè¦åŠ å…¥æ—‹è½‰ã€ç¿»è½‰ç­‰å…¶ä»–è®Šæ›

â— ç¸½çµå»ºè­°

  çµè«–: ä¸å€¼å¾—æ”¹ç”¨ Media3 VideoEffect

  ä¸»è¦åŸå› ï¼š

  1. ç•¶å‰å¯¦ä½œå·²ç¶“å¾ˆå„ªç§€ - ä½å»¶é²ã€é«˜æ•ˆèƒ½ã€åŠŸèƒ½å®Œæ•´
  2. ä½¿ç”¨å ´æ™¯ä¸éœ€è¦ - åœ–ç‰‡å½±ç‰‡ç€è¦½å™¨é‡è¦–å¿«é€ŸéŸ¿æ‡‰è€Œéé«˜å“è³ªè™•ç†
  3. å‡ç´šæˆæœ¬ vs æ”¶ç›Š - é‡å¯«ç¸®æ”¾é‚è¼¯çš„å·¥ä½œé‡ç›¸å°æ–¼æ”¶ç›Šéé«˜
  4. æ€§èƒ½å€’é€€é¢¨éšª - VideoEffect å¯èƒ½å¼•å…¥å»¶é²å’Œé¡å¤–é–‹éŠ·

  å‡ç´šåˆ° Media3 çš„å»ºè­°ç­–ç•¥ï¼š

  1. ä¿æŒç¾æœ‰ç¸®æ”¾å¯¦ä½œä¸è®Š
  2. åªå‡ç´š ExoPlayer æ ¸å¿ƒ API (import èªå¥å’ŒåŸºæœ¬ API èª¿ç”¨)
  3. åˆ©ç”¨ Media3 æ”¹é€²å…¶ä»–åŠŸèƒ½ (å¦‚æ›´å¥½çš„éŒ¯èª¤è™•ç†ã€buffering ç­–ç•¥)

  ç¾æœ‰å¯¦ä½œçš„å„ªå‹¢ç¸½çµï¼š

  - âœ… å³æ™‚éŸ¿æ‡‰ - Matrix è®Šæ›ç„¡å»¶é²
  - âœ… è¨˜æ†¶é«”æ•ˆç‡ - ä¸é¡å¤–æ¶ˆè€— GPU è¨˜æ†¶é«”
  - âœ… åŠŸèƒ½å®Œæ•´ - æ‰‹å‹¢è™•ç†ã€ç´„æŸé‚è¼¯éƒ½å¾ˆå®Œå–„
  - âœ… ç©©å®šæ€§ - å·²ç¶“éå¯¦éš›ä½¿ç”¨é©—è­‰
  - âœ… é©åˆå ´æ™¯ - å®Œå…¨ç¬¦åˆåœ–ç‰‡/å½±ç‰‡ç€è¦½å™¨çš„éœ€æ±‚

  å› æ­¤å»ºè­°åœ¨å‡ç´š Media3 æ™‚ï¼Œä¿æŒç¾æœ‰çš„è‡ªå®šç¾©ç¸®æ”¾å¯¦ä½œï¼Œé€™æ˜¯æœ€å‹™å¯¦ä¸”æœ‰æ•ˆç‡çš„é¸æ“‡ã€‚


> å¦‚æœç”¨ Media3 åŸç”Ÿ API ä¾†å¯¦ä½œ Advanced Video Controls (brightness/contrast)ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿå’Œç”¨
  VideoEffect å¯¦ä½œ zoom åŠŸèƒ½ä¸€æ¨£éœ€è¦é¡å¤–çš„ GPU é–‹éŠ·ï¼Ÿ

â— æ˜¯çš„ï¼Œä½ çš„åˆ†æå®Œå…¨æ­£ç¢ºï¼ä½¿ç”¨ Media3 åŸç”Ÿ API å¯¦ä½œ Advanced Video Controls
  (brightness/contrast) ç¢ºå¯¦å’Œç”¨ VideoEffect å¯¦ä½œ zoom åŠŸèƒ½ä¸€æ¨£ï¼Œéƒ½éœ€è¦é¡å¤–çš„ GPU é–‹éŠ·ã€‚

  Media3 VideoEffect è™•ç†æ–¹å¼

  æ‰€æœ‰ VideoEffect éƒ½éœ€è¦ GPU è™•ç†

  // ä»»ä½• VideoEffect éƒ½éœ€è¦ GPU ç®¡ç·šè™•ç†æ¯ä¸€å¹€
  val brightnessEffect = RgbMatrix.Builder()
      .setBrightness(0.2f)  // å¢åŠ äº®åº¦
      .build()

  val contrastEffect = RgbMatrix.Builder()
      .setContrast(1.5f)    // å¢åŠ å°æ¯”åº¦
      .build()

  // é€™äº›æ•ˆæœéƒ½éœ€è¦åœ¨ GPU ä¸Šè™•ç†æ¯ä¸€å¹€
  player.setVideoEffects(listOf(brightnessEffect, contrastEffect))

  æ€§èƒ½é–‹éŠ·æ¯”è¼ƒ

  GPU è™•ç†é–‹éŠ· (VideoEffect æ–¹å¼)

  - âŒ æ¯å¹€éƒ½éœ€è™•ç†: 60fps å½±ç‰‡ = æ¯ç§’ 60 æ¬¡ GPU é‹ç®—
  - âŒ è¨˜æ†¶é«”æ¶ˆè€—: é¡å¤–çš„ GPU è¨˜æ†¶é«”ç”¨æ–¼æ•ˆæœè™•ç†
  - âŒ é›»æ± æ¶ˆè€—: æŒçºŒçš„ GPU é‹ç®—å¢åŠ è€—é›»
  - âŒ å»¶é²: æ•ˆæœç®¡ç·šå¯èƒ½å¼•å…¥è™•ç†å»¶é²
  - âŒ ç†±é‡: é•·æ™‚é–“æ’­æ”¾å¯èƒ½å°è‡´è¨­å‚™ç™¼ç†±

  æ›¿ä»£æ–¹æ¡ˆ: ç³»çµ±å±¤é¢æ§åˆ¶

  1. äº®åº¦æ§åˆ¶ - ä½¿ç”¨ Window å±¬æ€§ (æ¨è–¦)

  // ç„¡ GPU é–‹éŠ·ï¼Œåªå½±éŸ¿æ•´å€‹è¢å¹•
  fun setBrightness(brightness: Float) {
      val layoutParams = window.attributes
      layoutParams.screenBrightness = brightness  // 0.0f åˆ° 1.0f
      window.attributes = layoutParams
  }

  2. å°æ¯”åº¦/è‰²å½©èª¿æ•´ - ä½¿ç”¨ ColorFilter (è¼ƒè¼•é‡)

  // åœ¨ View å±¤é¢è™•ç†ï¼Œæ¯” VideoEffect è¼•é‡
  val colorMatrix = ColorMatrix()
  colorMatrix.setSaturation(1.2f)  // å¢åŠ é£½å’Œåº¦
  val colorFilter = ColorMatrixColorFilter(colorMatrix)

  // æ‡‰ç”¨åˆ° PlayerView
  playerView.setColorFilter(colorFilter)

  é‡å° LiteGallery çš„å»ºè­°

  å»ºè­°å¯¦ä½œæ–¹å¼

  âœ… äº®åº¦æ§åˆ¶ - ä½¿ç”¨ç³»çµ±åŸç”Ÿ

  // è¼•é‡ä¸”å³æ™‚çš„äº®åº¦èª¿æ•´
  class BrightnessController {
      fun adjustBrightness(activity: Activity, brightness: Float) {
          val layoutParams = activity.window.attributes
          layoutParams.screenBrightness = brightness.coerceIn(0.01f, 1.0f)
          activity.window.attributes = layoutParams
      }
  }

  âš ï¸ å°æ¯”åº¦æ§åˆ¶ - è©•ä¼°éœ€æ±‚

  // å¦‚æœçœŸçš„éœ€è¦ï¼Œä½¿ç”¨ View å±¤é¢çš„ ColorFilter
  fun adjustContrast(view: View, contrast: Float) {
      val colorMatrix = ColorMatrix()
      val contrastValue = contrast.coerceIn(0.5f, 2.0f)

      // ç°¡åŒ–çš„å°æ¯”åº¦èª¿æ•´
      colorMatrix.set(floatArrayOf(
          contrastValue, 0f, 0f, 0f, 0f,
          0f, contrastValue, 0f, 0f, 0f,
          0f, 0f, contrastValue, 0f, 0f,
          0f, 0f, 0f, 1f, 0f
      ))

      view.colorFilter = ColorMatrixColorFilter(colorMatrix)
  }

  æ€§èƒ½å°æ¯”ç¸½çµ

  | åŠŸèƒ½   | VideoEffect | æ›¿ä»£æ–¹æ¡ˆ        | é–‹éŠ·å°æ¯”        |
  |------|-------------|-------------|-------------|
  | Zoom | é«˜ GPU é–‹éŠ·    | Matrix è®Šæ›   | ğŸŸ¢ 100x æ›´è¼•é‡ |
  | äº®åº¦   | é«˜ GPU é–‹éŠ·    | Window å±¬æ€§   | ğŸŸ¢ ç„¡é¡å¤–é–‹éŠ·    |
  | å°æ¯”åº¦  | é«˜ GPU é–‹éŠ·    | ColorFilter | ğŸŸ¡ è¼•é‡å¾ˆå¤š     |

  çµè«–

  å°æ–¼ åœ–ç‰‡/å½±ç‰‡ç€è¦½å™¨ çš„ä½¿ç”¨å ´æ™¯ï¼š

  âœ… æ¨è–¦å¯¦ä½œ

  1. Zoom: ä¿æŒç¾æœ‰ Matrix è®Šæ›å¯¦ä½œ
  2. äº®åº¦: ä½¿ç”¨ window.attributes.screenBrightness
  3. åŸºæœ¬è‰²å½©èª¿æ•´: ä½¿ç”¨ View-level ColorFilter

  âŒ é¿å…ä½¿ç”¨ VideoEffect çš„åŸå› 

  - éåº¦å·¥ç¨‹: å°ç€è¦½å™¨è€Œè¨€åŠŸèƒ½éæ–¼è¤‡é›œ
  - æ€§èƒ½å€’é€€: GPU é–‹éŠ·å½±éŸ¿æµæš¢åº¦
  - é›»æ± æ¶ˆè€—: ä¸é©åˆé•·æ™‚é–“ç€è¦½ä½¿ç”¨
  - å¯¦ä½œè¤‡é›œ: éœ€è¦ç®¡ç† GLSL shader å’Œæ•ˆæœç®¡ç·š

  ç¸½çµ: Media3 VideoEffect
  é©åˆå½±ç‰‡ç·¨è¼¯æ‡‰ç”¨ï¼Œä½†å°åª’é«”ç€è¦½å™¨ä¾†èªªï¼Œç³»çµ±å±¤é¢çš„è¼•é‡å¯¦ä½œæ›´åˆé©ä¸”æ•ˆèƒ½æ›´ä½³ã€‚
